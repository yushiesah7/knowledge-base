【Mermaid 記述ルール（完全版）】

────────────────────────
■ 1. 基本構文
────────────────────────

- ```mermaid ～``` のコードブロックで囲む。
- 最初に flowchart または graph を書き、方向を指定する。
  例：flowchart LR / TB / RL / BT

※ 本ルールは主に flowchart（フローチャート）を対象とする。
  sequence diagram / class diagram / state diagram 等は構文が異なるため、
  各公式ドキュメントを参照すること。

────────────────────────
■ 2. ノードIDの規則
────────────────────────

- 英数字とアンダースコアのみ使用（例：node_1, stepA）
- スペース・日本語・ハイフンは使わない（v10系パーサーが厳しいため）
- 文字列はすべてラベル側に書く（IDとは別）

────────────────────────
■ 3. ラベル（ノードの表示文字）
────────────────────────

- ラベルは `A["ラベル"]` の `["..."]` の中に書く（日本語/スペースOK）。
- **ラベルの中に余計な `"` や `\`（バックスラッシュ）を入れない**（Mermaidパースエラーになりやすい）。
  - コードブロック内で `\"...\"` のようなエスケープは不要。入れると壊れる。
- 改行は `<br/>` を使用。
  - `\n` は環境によって効かない場合があるため、**`<br/>` に統一すること**。
- **ラベル内の `()`（括弧）は一部の Mermaid レンダラでパースエラーになることがある**ため、基本的に使わない（`:` や `-`、`optional` 等で表現する）。
  - 特に `A[fsync (optional)]` や `B -->|prompt (masked)| C` のような「括弧入りラベル」は避ける。

OK:
```text
A["開始ステップ"]
node_auto["自動運用<br/>keepers + overlay"]

B -->|prompt masked| C
C["fsync optional"]
```

NG:
```text
node_auto["\"自動運用\""]   # \" が混ざる（壊れやすい）
node_auto["\自動運用\"]     # バックスラッシュが混ざる（壊れる）

B -->|prompt (masked)| C    # 一部レンダラで括弧が原因で壊れる
C[fsync (optional)]         # 一部レンダラで括弧が原因で壊れる
```

────────────────────────
■ 4. subgraph の書き方
────────────────────────

- 形式：
    subgraph ID["ラベル"]
        ...
    end
- 必ず end で閉じる（未閉じは重大エラー）

────────────────────────
■ 5. 特殊文字のエスケープ
────────────────────────

- `|` → `&#124;`
- `;` → `&#59;`
- `%` → `&#37;`
- `&` → `&#38;`
- `#` → `&#35;`

────────────────────────
■ 6. 色・スタイル（文字黒固定＋カラフル高コントラスト）
────────────────────────
■ ノードの文字色は常に黒
style ID color:#000000

■ 枠線も黒（視認性UP）
style ID stroke:#000000

■ 背景色のみカラフルに（高明度パステル推奨）
style A fill:#cce5ff,stroke:#000000,color:#000000   ← 青
style B fill:#d4edda,stroke:#000000,color:#000000   ← 緑
style C fill:#fff3cd,stroke:#000000,color:#000000   ← 黄
style D fill:#f8d7da,stroke:#000000,color:#000000   ← 赤

■テーマ依存を避けるため、背景色（fill）は必ず指定すること。

────────────────────────
■ 7. 線（リンク）の色（黒背景/白背景どちらでも見える）
────────────────────────

黒背景テーマだと線が黒だと見えづらいので、**黒でも白でも視認できるニュートラルグレー**に統一する。

推奨:
- `#6b7280`（グレー。暗背景でも白背景でも見える）

例：

linkStyle 0 stroke:#6b7280,stroke-width:2px
linkStyle 1 stroke:#6b7280,stroke-width:2px
…（0,1,2,...のインデックスで指定）

※ まとめて指定したい場合は `linkStyle default ...` を使ってよい。

────────────────────────
■ 8. Mermaid v10 の注意点（重要）
────────────────────────

- IDの重複は禁止
- subgraphの閉じ忘れは即エラー
- 改行は `<br/>` を使う（`\n` は環境差があるため非推奨）
- テーマによる色変化を避けるため fill を明示指定
- 日本語は必ずラベル側（例: `A["日本語"]`）に書く
- ラベル内の `()`（括弧）は一部レンダラでパースエラーになり得るため避ける（代替: `:` / `-` / `optional`）

────────────────────────
■ 9. よくある構造のひな形
────────────────────────
flowchart LR
    A["開始"] --> B["処理<br/>ステップ1"]

    subgraph block_1["まとめ"]
        C["内部処理"] --> D["次の処理"]
    end

    B --> C
